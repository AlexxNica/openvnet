<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>Installation - OpenVNet</title>
  

  <link rel="shortcut icon" href="../favicon.png">
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  <link href="../custom.css" rel="stylesheet">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Installation";
    var mkdocs_page_input_path = "installation.md";
    var mkdocs_page_url = "/installation/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-63388719-2', 'auto');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> OpenVNet</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="..">Home</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../concept/">Concept</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../features/">Features</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href="./">Installation</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#openvnet-installation-guide">OpenVNet Installation Guide</a></li>
                
                    <li><a class="toctree-l4" href="#overview">Overview</a></li>
                
                    <li><a class="toctree-l4" href="#requirements">Requirements</a></li>
                
                    <li><a class="toctree-l4" href="#installation">Installation</a></li>
                
                    <li><a class="toctree-l4" href="#lxc-setup">LXC Setup</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../upgrade/">Upgrading</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Creating virtual networks</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../creating-virtual-networks/single-network/">Single network</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../creating-virtual-networks/single-network-dhcp/">Single network with DHCP server</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../creating-virtual-networks/two-networks/">Two networks</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../creating-virtual-networks/two-networks-router/">Two network with router</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Advanced Features</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../advanced-features/filters/">Filters</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Debugging</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../debugging/vnflows-monitor/">vnflows-monitor</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../debugging/integration-test/">Integration test</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../debugging/troubleshooting/">Troubleshooting</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Configuration files</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../configuration-files/common/">common.conf</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../configuration-files/vnmgr/">vnmgr.conf</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../configuration-files/webapi/">webapi.conf</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../configuration-files/vna/">vna.conf</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../configuration-files/vnctl/">vnctl.conf</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Vnctl</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../vnctl/datapaths/">datapaths</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../vnctl/interfaces/">interfaces</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../vnctl/networks/">networks</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../vnctl/filters/">filters</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../community/">Community</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../jargon-dictionary/">Jargon Dictionary</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">OpenVNet</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Installation</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/axsh/openvnet" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="openvnet-installation-guide">OpenVNet Installation Guide</h1>
<h2 id="overview">Overview</h2>
<p>Welcome to the world of OpenVNet! With this installation guide we help you
create a very simple yet innovative virtual network environment.</p>
<p>In this guide we are going to install all of OpenVNet's services into a single machine running CentOS. This can be a virtual machine. Afterwards we are going to use LXC to set up two containers that we'll connect to OpenVNet's virtual networks.</p>
<p><img alt="All in one host" src="../img/all-in-one-host.png" /></p>
<h2 id="requirements">Requirements</h2>
<ul>
<li>CentOS 6</li>
<li>Internet connection</li>
</ul>
<h2 id="installation">Installation</h2>
<h3 id="install-openvnet-packages">Install OpenVNet Packages</h3>
<p>Download the openvnet.repo file and put it to your <code>/etc/yum.repos.d/</code> directory.</p>
<pre><code class="bash">curl -o /etc/yum.repos.d/openvnet.repo -R https://raw.githubusercontent.com/axsh/openvnet/master/deployment/yum_repositories/stable/openvnet.repo
</code></pre>

<p>Download the openvnet-third-party.repo file and put it in your <code>/etc/yum.repos.d/</code> directory.</p>
<pre><code class="bash">curl -o /etc/yum.repos.d/openvnet-third-party.repo -R https://raw.githubusercontent.com/axsh/openvnet/master/deployment/yum_repositories/stable/openvnet-third-party.repo
</code></pre>

<p>Each repo has the following packages:</p>
<h4 id="openvnetrepo">openvnet.repo</h4>
<ul>
<li>openvnet (metapackage)</li>
<li>openvnet-common</li>
<li>openvnet-vna</li>
<li>openvnet-vnmgr</li>
<li>openvnet-webapi</li>
<li>openvnet-vnctl</li>
</ul>
<h4 id="openvnet-third-partyrepo">openvnet-third-party.repo</h4>
<ul>
<li>openvnet-ruby</li>
<li>openvswitch</li>
</ul>
<p>Install epel-release.</p>
<pre><code class="bash">yum install -y epel-release
</code></pre>

<p>Install OpenVNet packages.</p>
<pre><code class="bash">yum install -y openvnet
</code></pre>

<p><code>openvnet</code> is an metapackage that depends on <code>openvnet-common</code>, <code>openvnet-vna</code>, <code>openvnet-vnmgr</code>, <code>openvnet-webapi</code> and <code>openvnet-vnctl</code>. It's just a convenient way to install all of those at once.</p>
<p>Install <a href="http://redis.io">Redis</a> and <a href="https://www.mysql.com">MySQL server</a>. Redis is required for OpenVNet's processes to communicate and MySQL is used to store the network state.</p>
<p>Though they're both required, they are not package dependencies because OpenVNet is distributed software. In a production environment, it is very likely for these packages to be installed on other machines than the OpenVNet processes themselves.</p>
<pre><code class="bash">yum install -y mysql-server redis
</code></pre>

<h3 id="setup-open-vswitch">Setup Open vSwitch</h3>
<p>We are going to create a bridge <code>br0</code> using Open vSwitch. Later we will attach our VMs <code>inst1</code> and <code>inst2</code> to this bridge.</p>
<p>Create the file <code>/etc/sysconfig/network-scripts/ifcfg-br0</code> with the following contents.</p>
<pre><code class="bash">DEVICE=br0
DEVICETYPE=ovs
TYPE=OVSBridge
ONBOOT=yes
BOOTPROTO=static
HOTPLUG=no
OVS_EXTRA=&quot;
 set bridge     ${DEVICE} protocols=OpenFlow10,OpenFlow12,OpenFlow13 --
 set bridge     ${DEVICE} other_config:disable-in-band=true --
 set bridge     ${DEVICE} other-config:datapath-id=0000aaaaaaaaaaaa --
 set bridge     ${DEVICE} other-config:hwaddr=02:01:00:00:00:01 --
 set-fail-mode  ${DEVICE} secure --
 set-controller ${DEVICE} tcp:127.0.0.1:6633
&quot;
</code></pre>

<p><strong>Remark:</strong> Notice how we set the <code>datapath-id</code> to <code>0000aaaaaaaaaaaa</code>? This is a unique ID that OpenVNet will use to recognise this bridge later. You can set it to any 16 hex digits of your choosing but make sure to remember it for later.</p>
<p>Start the <code>openvswitch</code> service and bring  up the bridge.</p>
<pre><code class="bash">service openvswitch start
ifup br0
</code></pre>

<h3 id="setup-database">Setup Database</h3>
<p>Launch the MySQL server.</p>
<pre><code class="bash">service mysqld start
</code></pre>

<p>OpenVNet uses its own ruby binary. We need to add it to the <code>PATH</code> variable so we can call bundle in the next step.</p>
<pre><code class="bash">PATH=/opt/axsh/openvnet/ruby/bin:${PATH}
</code></pre>

<p>Create database</p>
<pre><code class="bash">cd /opt/axsh/openvnet/vnet
bundle exec rake db:create
bundle exec rake db:init
</code></pre>

<h3 id="start-redis">Start redis</h3>
<p>As mentioned above, OpenVNet services require redis to communicate with each other. Start it.</p>
<pre><code class="bash">service redis start
</code></pre>

<h3 id="start-openvnet-services">Start OpenVNet services</h3>
<p>Starting the OpenVNet services will create log files in the <code>/var/log/openvnet</code> directory. If anything goes wrong, you might find useful error messages in them.</p>
<p>Start vnmgr and webapi.</p>
<pre><code class="bash">initctl start vnet-vnmgr
initctl start vnet-webapi
</code></pre>

<p>We use <code>vnctl</code> to create the database records subsequent to the above configurations. <code>vnctl</code> is a Web API client offered by the <code>openvnet-vnctl</code> package.</p>
<h4 id="datapath">Datapath</h4>
<p>Remember the <code>datapath-id</code> we set when setting up Open vSwitch? The following command will tell OpenVNet that VNA needs to manage this datapath.</p>
<pre><code class="bash">vnctl datapaths add --uuid dp-test1 --display-name test1 --dpid 0x0000aaaaaaaaaaaa --node-id vna
</code></pre>

<h4 id="mac-address-range">Mac Address Range</h4>
<p>In order for the network overlay to work, OpenVNet uses mac addresses independently of any real or virtual interface. To allocate these it requires the creation of a default mac range group.</p>
<pre><code class="bash">vnctl mac_range_groups add --uuid mrg-dpg
</code></pre>

<p>In <a href="../configuration-files/common">common.conf</a>, the mac range group is set by default to <code>mrg-dpg</code> and can be changed using the <code>datapath_mac_group</code> option.</p>
<pre><code class="bash">vnctl mac_range_groups mac_ranges add mrg-dpg --begin_mac_address 52:56:01:00:00:00 --end_mac_address 52:56:01:ff:ff:ff
</code></pre>

<ul>
<li>
<p><strong>begin_mac_address</strong> : The lowest possible mac address value in the range.</p>
</li>
<li>
<p><strong>end_mac_address</strong> : The highest possible mac address value in the range.</p>
</li>
</ul>
<p>Now let's start vna.</p>
<pre><code class="bash">initctl start vnet-vna
</code></pre>

<p>You can run <code>ovs-vsctl show</code> to check if vna is working correctly.</p>
<p>You should be able to see <code>is_connected: true</code> in its output. If it doesn't appear right away, wait a few seconds and then try again. If it still doesn't appear, something went wrong and you should have a look at <code>/var/log/openvnet/vna.log</code> for errors.</p>
<pre><code class="bash">fbe23184-7f14-46cb-857b-3abf6153a6d6
    Bridge &quot;br0&quot;
        Controller &quot;tcp:127.0.0.1:6633&quot;
            is_connected: true
</code></pre>

<h2 id="lxc-setup">LXC Setup</h2>
<p>We now have OpenVNet set up and working but we don't have any virtual machines connected to it yet. In this step we are going to use <a href="https://linuxcontainers.org">LXC</a> to create the two containers (guests) <code>inst1</code> and <code>inst2</code> that will be connected to OpenVNet's virtual networks.</p>
<p>Any virtualization techonology will work but in this guide we're using LXC because it's lightweight and can easily be set up inside virtual machines as well.</p>
<h3 id="install-lxc">Install LXC</h3>
<pre><code class="bash">yum -y install lxc lxc-templates
</code></pre>

<h3 id="create-and-mount-cgroup">Create and mount cgroup</h3>
<pre><code class="bash">mkdir /cgroup
echo &quot;cgroup /cgroup cgroup defaults 0 0&quot; &gt;&gt; /etc/fstab
mount /cgroup
</code></pre>

<h3 id="create-2-lxc-guests">Create 2 LXC guests</h3>
<p>Rsync is required for this. If it's not installed already, install it with the following command.</p>
<pre><code class="bash">yum install -y rsync
</code></pre>

<pre><code class="bash">lxc-create -t centos -n inst1
lxc-create -t centos -n inst2
</code></pre>

<p>These commands' output will tell you were to find or set the root password for <code>inst1</code> and <code>inst2</code>. Make sure set it and remember it for later. You're going to need it to log into them.</p>
<h3 id="apply-network-interface-settings">Apply Network interface settings</h3>
<p>Open the file <code>/var/lib/lxc/inst1/config</code> and replace its contents with the following.</p>
<pre><code class="bash">lxc.network.type = veth
lxc.network.flags = up
lxc.network.veth.pair = inst1
lxc.network.hwaddr = 10:54:FF:00:00:01
lxc.rootfs = /var/lib/lxc/inst1/rootfs
lxc.include = /usr/share/lxc/config/centos.common.conf
lxc.arch = x86_64
lxc.utsname = inst1
lxc.autodev = 0
</code></pre>

<p>Open the file <code>/var/lib/lxc/inst2/config</code> and replace its contents with the following.</p>
<pre><code class="bash">lxc.network.type = veth
lxc.network.flags = up
lxc.network.veth.pair = inst2
lxc.network.hwaddr = 10:54:FF:00:00:02
lxc.rootfs = /var/lib/lxc/inst2/rootfs
lxc.include = /usr/share/lxc/config/centos.common.conf
lxc.arch = x86_64
lxc.utsname = inst2
lxc.autodev = 0
</code></pre>

<p><strong>Remark:</strong> We do not use <code>lxc.network.link</code> parameter because the Linux bridge is replaced by the Open vSwitch. That parameter expects to interface with the Linux bridge and containers will fail to start if you attempt to use it with Open vSwitch. We'll enslave the tap interfaces manually in the next step.</p>
<h3 id="start-the-lxc-guests">Start the LXC guests</h3>
<pre><code class="bash">lxc-start -d -n inst1
lxc-start -d -n inst2
</code></pre>

<h3 id="attach-them-to-open-vswitch">Attach them to Open vSwitch</h3>
<pre><code class="bash">ovs-vsctl add-port br0 inst1
ovs-vsctl add-port br0 inst2
</code></pre>

<p>Now the LXC's network interfaces are attached to the Open vSwitch. This is basically the same as plugging a network cable into a physical switch.</p>
<p>Congratulations. You have now installed OpenVNet and you're ready to start building your first virtual network. We recommend you start with the simplest possible setting: <a href="../creating-virtual-networks/single-network">Single Network</a>.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../upgrade/" class="btn btn-neutral float-right" title="Upgrading">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../features/" class="btn btn-neutral" title="Features"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright &copy; 2016, <a href="http://axsh.jp/">Axsh Co. Ltd.</a>.</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/axsh/openvnet" class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../features/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../upgrade/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
