<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>vnflows-monitor - OpenVNet</title>
  

  <link rel="shortcut icon" href="../../favicon.png">
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  <link href="../../custom.css" rel="stylesheet">

  
  <script>
    // Current page data
    var mkdocs_page_name = "vnflows-monitor";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 

  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-63388719-2', 'auto');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> OpenVNet</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Home</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../concept/">Concept</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../features/">Features</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../installation/">Installation</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Creating virtual networks</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../creating-virtual-networks/single-network/">Single network</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../creating-virtual-networks/single-network-dhcp/">Single network with DHCP server</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../creating-virtual-networks/two-networks/">Two networks</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../creating-virtual-networks/two-networks-router/">Two network with router</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Debugging</span></li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">vnflows-monitor</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#vnflows-monitor">Vnflows monitor</a></li>
                
                    <li><a class="toctree-l4" href="#monitoring-changes-in-flows-as-they-happen">Monitoring changes in flows as they happen</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../integration-test/">Integration test</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../troubleshooting/">Troubleshooting</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Configuration files</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../configuration-files/common/">common.conf</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../configuration-files/vnmgr/">vnmgr.conf</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../configuration-files/webapi/">webapi.conf</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../configuration-files/vna/">vna.conf</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../configuration-files/vnctl/">vnctl.conf</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Vnctl</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../vnctl/datapaths/">datapaths</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../vnctl/interfaces/">interfaces</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../vnctl/networks/">networks</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../community/">Community</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../jargon-dictionary/">Jargon Dictionary</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">OpenVNet</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Debugging &raquo;</li>
        
      
    
    <li>vnflows-monitor</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/axsh/openvnet" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="vnflows-monitor">Vnflows monitor</h1>
<p>Vnflows-monitor is a debug tool that automatically gets installed along with VNA. You can use it to display the flows that are currently present in Open vSwitch.</p>
<p>To run it first make sure that OpenVNet's ruby binary is in your <code>PATH</code>.</p>
<pre><code class="bash">PATH=/opt/axsh/openvnet/ruby/bin:${PATH}
</code></pre>

<p>Now run it like so:</p>
<pre><code class="bash">cd /opt/axsh/openvnet/vnet/bin/
./vnflows-monitor
</code></pre>

<p>If Open vSwitch is running and currently has flows in it, you should see this kind of output.</p>
<pre><code class="bash">(0): TABLE_CLASSIFIER
  0-00        0       0 =&gt; SWITCH(0x0)               actions=write_metadata:REMOTE(0x0),goto_table:TABLE_TUNNEL_PORTS(3)
  0-01        0       0 =&gt; SWITCH(0x0)              tun_id=0 actions=drop
  0-02       28       0 =&gt; PORT(0x1)                in_port=1 actions=write_metadata:TYPE_INTERFACE|LOCAL(0x1),goto_table:TABLE_INTERFACE_EGRESS_CLASSIFIER(15)
  0-02       22       0 =&gt; PORT(0x2)                in_port=2 actions=write_metadata:TYPE_INTERFACE|LOCAL(0x5),goto_table:TABLE_INTERFACE_EGRESS_CLASSIFIER(15)
  0-02        0       0 =&gt; SWITCH(0x0)              in_port=CONTROLLER actions=write_metadata:LOCAL|NO_CONTROLLER(0x0),goto_table:TABLE_CONTROLLER_PORT(7)
  0-02        0       0 =&gt; PORT(0x7ffffffe)         in_port=LOCAL actions=write_metadata:LOCAL(0x0),goto_table:TABLE_LOCAL_PORT(6)
(3): TABLE_TUNNEL_PORTS
  3-00        0       0 =&gt; SWITCH(0x0)               actions=drop
(4): TABLE_TUNNEL_NETWORK_IDS
  4-00        0       0 =&gt; SWITCH(0x0)               actions=drop
  4-30        0       0 =&gt; ROUTE_LINK(0x1)          tun_id=0x10000001,dl_dst=02:00:10:00:00:01 actions=write_metadata:TYPE_ROUTE_LINK(0x1),goto_table:TABLE_ROUTER_CLASSIFIER(33)
  4-30        0       0 =&gt; NETWORK(0x1)             tun_id=0x80000001 actions=write_metadata:TYPE_NETWORK(0x1),goto_table:TABLE_NETWORK_SRC_CLASSIFIER(20)
  4-30        0       0 =&gt; NETWORK(0x2)             tun_id=0x80000002 actions=write_metadata:TYPE_NETWORK(0x2),goto_table:TABLE_NETWORK_SRC_CLASSIFIER(20)
(6): TABLE_LOCAL_PORT
  6-00        0       0 =&gt; SWITCH(0x0)               actions=drop
...
</code></pre>

<p>As you can see in this output flows are grouped in what we call "flow tables".</p>
<p>The numbers on the left are the flow table index followed the the flow's priority. Packets traversing Open vSwitch start in the flow table with index 0 and will get matched against the flows with the highest priority first.</p>
<p>The next number shows the amount of packets that have been matched against the flow. For most flows in the above example that is 0 but there's two flows that have been matched 28 and 22 times respectively.</p>
<p>Next is the flow's cookie. What a cookie is in OpenFlow is beyond the scope of this guide.</p>
<p>Finally, on the right we see the data we are matching packets against and the actions we undertake in case a match is found.</p>
<h2 id="monitoring-changes-in-flows-as-they-happen">Monitoring changes in flows as they happen</h2>
<p>One of vnflows-monitor's most useful features is the ability to continously monitor flows and report any changes immediately. Try running it with the following arguments.</p>
<pre><code class="bash">cd /opt/axsh/openvnet/vnet/bin
./vnflows-monitor -d -c 0
</code></pre>

<p>Now it will constantly keep iterating and probably not show any output. While this is going on, try having two VMs in virtual networks ping each other. For example have <code>inst1</code> from the installation guide ping <code>inst2</code>.</p>
<p>You should see this kind of output.</p>
<pre><code class="bash">-------run:4--iteration:43-------
(0): TABLE_CLASSIFIER
  0-02       34       0 =&gt; PORT(0x1)                in_port=1 actions=write_metadata:TYPE_INTERFACE|LOCAL(0x1),goto_table:TABLE_INTERFACE_EGRESS_CLASSIFIER(15)
  0-02       28       0 =&gt; PORT(0x2)                in_port=2 actions=write_metadata:TYPE_INTERFACE|LOCAL(0x5),goto_table:TABLE_INTERFACE_EGRESS_CLASSIFIER(15)
(15): TABLE_INTERFACE_EGRESS_CLASSIFIER
 15-30       11       0 =&gt; INTERFACE(0x1)[0x12]     ip,metadata=TYPE_INTERFACE(0x1),dl_src=10:54:ff:00:00:01,nw_src=10.100.0.10 actions=write_metadata:TYPE_NETWORK(0x1),goto_table:TABLE_INTERFACE_EGR
ESS_FILTER(18)
 15-30        8       0 =&gt; INTERFACE(0x5)[0x12]     ip,metadata=TYPE_INTERFACE(0x5),dl_src=10:54:ff:00:00:02,nw_src=192.168.50.10 actions=write_metadata:TYPE_NETWORK(0x2),goto_table:TABLE_INTERFACE_E
GRESS_FILTER(18)
(18): TABLE_INTERFACE_EGRESS_FILTER
 18-00       38       0 =&gt; SWITCH(0x0)               actions=goto_table:TABLE_NETWORK_SRC_CLASSIFIER(20)
(20): TABLE_NETWORK_SRC_CLASSIFIER
 20-30       25       0 =&gt; NETWORK(0x1)             metadata=TYPE_NETWORK(0x1) actions=goto_table:TABLE_ROUTE_INGRESS_INTERFACE(30)
 20-30       13       0 =&gt; NETWORK(0x2)             metadata=TYPE_NETWORK(0x2) actions=goto_table:TABLE_ROUTE_INGRESS_INTERFACE(30)
(30): TABLE_ROUTE_INGRESS_INTERFACE
 30-10        8       0 =&gt; INTERFACE(0x6)[0x12]     ip,metadata=TYPE_NETWORK(0x1),dl_dst=02:00:00:00:02:01 actions=write_metadata:TYPE_INTERFACE(0x6),goto_table:TABLE_ROUTE_INGRESS_TRANSLATION(31)
 30-10        8       0 =&gt; INTERFACE(0x7)[0x12]     ip,metadata=TYPE_NETWORK(0x2),dl_dst=02:00:00:00:02:02 actions=write_metadata:TYPE_INTERFACE(0x7),goto_table:TABLE_ROUTE_INGRESS_TRANSLATION(31)
(31): TABLE_ROUTE_INGRESS_TRANSLATION
 31-90        8       0 =&gt; INTERFACE(0x6)           metadata=TYPE_INTERFACE(0x6) actions=goto_table:TABLE_ROUTER_INGRESS_LOOKUP(32)
 31-90        8       0 =&gt; INTERFACE(0x7)           metadata=TYPE_INTERFACE(0x7) actions=goto_table:TABLE_ROUTER_INGRESS_LOOKUP(32)
(32): TABLE_ROUTER_INGRESS_LOOKUP
 32-30        8       0 =&gt; ROUTE(0x1)               ip,metadata=TYPE_INTERFACE(0x6),nw_src=10.100.0.0/24 actions=write_metadata:TYPE_ROUTE_LINK|REFLECTION(0x1),goto_table:TABLE_ROUTER_CLASSIFIER(33)
 32-30        8       0 =&gt; ROUTE(0x2)               ip,metadata=TYPE_INTERFACE(0x7),nw_src=192.168.50.0/24 actions=write_metadata:TYPE_ROUTE_LINK|REFLECTION(0x1),goto_table:TABLE_ROUTER_CLASSIFIER(33
)
33): TABLE_ROUTER_CLASSIFIER
 33-30       16       0 =&gt; ROUTE_LINK(0x1)          metadata=TYPE_ROUTE_LINK(0x1) actions=goto_table:TABLE_ROUTER_EGRESS_LOOKUP(34)
(34): TABLE_ROUTER_EGRESS_LOOKUP
 34-30        8       0 =&gt; ROUTE(0x1)               ip,metadata=TYPE_ROUTE_LINK(0x1),nw_dst=10.100.0.0/24 actions=write_metadata:0x8000000600000001,goto_table:TABLE_ROUTE_EGRESS_LOOKUP(35)
 34-30        8       0 =&gt; ROUTE(0x2)               ip,metadata=TYPE_ROUTE_LINK(0x1),nw_dst=192.168.50.0/24 actions=write_metadata:0x8000000700000001,goto_table:TABLE_ROUTE_EGRESS_LOOKUP(35)
(35): TABLE_ROUTE_EGRESS_LOOKUP
 35-20        8       0 =&gt; INTERFACE(0x6)[0x12]     metadata=VALUE_PAIR(0x8000000600000000/0xffffffff00000000)(0x0) actions=write_metadata:0x702000000000006,goto_table:TABLE_ROUTE_EGRESS_TRANSLATION(
36)
 35-20        8       0 =&gt; INTERFACE(0x7)[0x12]     metadata=VALUE_PAIR(0x8000000700000000/0xffffffff00000000)(0x0) actions=write_metadata:0x702000000000007,goto_table:TABLE_ROUTE_EGRESS_TRANSLATION(
36)
(36): TABLE_ROUTE_EGRESS_TRANSLATION
 36-90        8       0 =&gt; INTERFACE(0x6)           metadata=TYPE_INTERFACE(0x6) actions=goto_table:TABLE_ROUTE_EGRESS_INTERFACE(37)
 36-90        8       0 =&gt; INTERFACE(0x7)           metadata=TYPE_INTERFACE(0x7) actions=goto_table:TABLE_ROUTE_EGRESS_INTERFACE(37)
(37): TABLE_ROUTE_EGRESS_INTERFACE
 37-20        8       0 =&gt; INTERFACE(0x6)[0x12]     metadata=TYPE_INTERFACE(0x6) actions=set_field:02:00:00:00:02:01-&gt;eth_src,write_metadata:TYPE_NETWORK(0x1),goto_table:TABLE_ARP_TABLE(40)
 37-20        8       0 =&gt; INTERFACE(0x7)[0x12]     metadata=TYPE_INTERFACE(0x7) actions=set_field:02:00:00:00:02:02-&gt;eth_src,write_metadata:TYPE_NETWORK(0x2),goto_table:TABLE_ARP_TABLE(40)
(40): TABLE_ARP_TABLE
 40-40        8       0 =&gt; INTERFACE(0x1)[0x12]     ip,metadata=TYPE_NETWORK(0x1),nw_dst=10.100.0.10 actions=set_field:10:54:ff:00:00:01-&gt;eth_dst,goto_table:TABLE_NETWORK_DST_CLASSIFIER(42)
 40-40        8       0 =&gt; INTERFACE(0x5)[0x12]     ip,metadata=TYPE_NETWORK(0x2),nw_dst=192.168.50.10 actions=set_field:10:54:ff:00:00:02-&gt;eth_dst,goto_table:TABLE_NETWORK_DST_CLASSIFIER(42)
(42): TABLE_NETWORK_DST_CLASSIFIER
 42-30       25       0 =&gt; NETWORK(0x1)             metadata=TYPE_NETWORK(0x1) actions=goto_table:TABLE_NETWORK_DST_MAC_LOOKUP(43)
 42-30       13       0 =&gt; NETWORK(0x2)             metadata=TYPE_NETWORK(0x2) actions=goto_table:TABLE_NETWORK_DST_MAC_LOOKUP(43)
(43): TABLE_NETWORK_DST_MAC_LOOKUP
 43-60       12       0 =&gt; INTERFACE(0x1)[0x12]     metadata=TYPE_NETWORK(0x1),dl_dst=10:54:ff:00:00:01 actions=write_metadata:TYPE_INTERFACE(0x1),goto_table:TABLE_INTERFACE_INGRESS_FILTER(45)
 43-60        8       0 =&gt; INTERFACE(0x5)[0x12]     metadata=TYPE_NETWORK(0x2),dl_dst=10:54:ff:00:00:02 actions=write_metadata:TYPE_INTERFACE(0x5),goto_table:TABLE_INTERFACE_INGRESS_FILTER(45)
(45): TABLE_INTERFACE_INGRESS_FILTER
 45-90       11       0 =&gt; INTERFACE(0x1)[0x71]     metadata=TYPE_INTERFACE(0x1) actions=goto_table:TABLE_OUT_PORT_INTERFACE_INGRESS(90)
 45-90        8       0 =&gt; INTERFACE(0x5)[0x71]     metadata=TYPE_INTERFACE(0x5) actions=goto_table:TABLE_OUT_PORT_INTERFACE_INGRESS(90)
(90): TABLE_OUT_PORT_INTERFACE_INGRESS
 90-10       12       0 =&gt; PORT(0x1)                metadata=TYPE_INTERFACE(0x1) actions=output:1
 90-10        8       0 =&gt; PORT(0x2)                metadata=TYPE_INTERFACE(0x5) actions=output:2

</code></pre>

<p>As the ping request and reply traverse Open vSwitch' flows, all the flows that they match will have their match counters incremented. Those and only those will now be outputted by vnflows-monitor. This allows us to immediately see which path our packets followed through Open vSwitch's flows.</p>
<p>This time we used vnflows-monitor to see which flows are matched when a packet comes through but another idea is to change the virtual network topology while it is running. This will show you exactly what flows get added and removed with each step. Have fun.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../integration-test/" class="btn btn-neutral float-right" title="Integration test"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../../creating-virtual-networks/two-networks-router/" class="btn btn-neutral" title="Two network with router"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright &copy; 2015, <a href="http://axsh.jp/">Axsh Co. Ltd.</a>.</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../../creating-virtual-networks/two-networks-router/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../integration-test/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
